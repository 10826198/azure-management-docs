---
title: Tutorial – Deploy AD-integrated Arc-enabled SQL Managed Instance
description: Tutorial to deploy AD-integrated Arc-enabled SQL Managed Instance
services: azure-arc
ms.service: azure-arc
ms.subservice: azure-arc-data
author: cloudmelon
ms.author: melqin
ms.reviewer: mikeray
ms.date: 04/05/2022
ms.topic: how-to
---


# Tutorial – Deploy AD-integrated SQL Managed Instance

This article explains how to deploy Azure Arc-enabled SQL Managed Instance with Active Directory (AD) authentication.
Before you proceed, you need to complete the steps explained in [Deploy an Bring your own keytab (BYOK) Active Directory (AD) connector](deploy-byok-active-directory-connector.md) or [Tutorial – Deploy an automatic AD connector](deploy-automatic-active-directory-connector.md)


## Prerequisites

Before you proceed, verify that you have:

* An Active Directory (AD) Domain
* An instance of Data Controller deployed
* An instance of Active Directory Connector deployed


## Arc-enabled SQL Managed Instance Spec for Active Directory Authentication

To enable an Arc-enabled SQL Managed Instance Active Directory Authentication, it needs to reference the Active Directory Connector instance it wants to use. Referencing the Active Directory Connector in SQL MI spec will automatically set up the needed environment in the SQL Managed Instance container for SQL MI to perform Active Directory authentication. 

To support Active Directory authentication on SQL Managed Instance, new spec fields are introduced as follows.

- **Required** (For AD authentication)
   - **spec.security.activeDirectory.connector.name** 
      Name of the pre-existing Active Directory Connector custom resource to join for AD authentication. When provided, system will assume that AD authentication is desired.
   - **spec.security.activeDirectory.accountName** 
      Name of the Active Directory (AD) account autogenerated for this SQL Managed Instance in automatic AD deployment mode. 
  - **spec.security.activeDirectory.keytabSecret**
     Name of the Kubernetes secret hosting the pre-created keytab file by users. This secret must be in the same namespace as the SQL Managed Instance.This parameter is only required for the AD deployment in BOYK mode. 
  - **spec.services.primary.dnsName**
     DNS name for the primary endpoint, this is the primary for the SQL Managed Instance endpoint 
  - **spec.services.primary.port**
     Port number for the primary endpoint, this is port number for the SQL Managed Instance endpoint 

- **Optional**
  - **spec.security.activeDirectory.connector.namespace**
     Kubernetes namespace of the pre-existing Active Directory Connector instance to join for AD authentication. When not provided, system will assume the same namespace as the SQL Managed Instance.

### Prepare Arc-enabled SQL Managed Instance yaml spec

Prepare the following yaml specification to deploy a SQL Managed Instance. The fields described above should be specified in the spec.

> [!NOTE]
> The *admin-login-secret* in the yaml example is used for basic authentication. You can use it to login into the SQL Managed instance, and then create SQL logins for AD users and groups. Check out [Connect to AD-integrated Azure Arc-enabled SQL Managed Instance](connect-active-directory-sql-managed-instance.md) for further details. 


```yaml
apiVersion: v1
data:
  password: <your base64 encoded password>
  username: <your base64 encoded username>
kind: Secret
metadata:
  name: admin-login-secret
type: Opaque
---
apiVersion: sql.arcdata.microsoft.com/v3
kind: SqlManagedInstance
metadata:
  name: <name>
  namespace: <namespace>
spec:
  backup:
    retentionPeriodInDays: 7
  dev: false
  tier: GeneralPurpose
  forceHA: "true"
  licenseType: LicenseIncluded
  replicas: 1
  security:
    adminLoginSecret: admin-login-secret
    activeDirectory:
      connector:
        name: <AD connector name>
        namespace: <AD connector namespace>
      accountName: <AD account name>
      keytabSecret: <Keytab secret name>
  services:
    primary:
      type: LoadBalancer
      dnsName: <Endpoint DNS name>
      port: <Endpoint port number>
  storage:
    data:
      volumes:
      - accessMode: ReadWriteOnce
        className: local-storage
        size: 5Gi
    logs:
      volumes:
      - accessMode: ReadWriteOnce
        className: local-storage
        size: 5Gi
```

### Deploy SQL Managed Instance

To deploy the SQL Managed Instance using the prepared spec, save the spec file as sqlmi.yaml or any name of your choice.
Run the following command to deploy the spec in the file:

```console
kubectl apply -f sqlmi.yaml
```

## Next steps

* [Connect to AD-integrated Azure Arc-enabled SQL Managed Instance](connect-active-directory-sql-managed-instance.md).

